# kiitportal-exploit

About
======
 This exploit was developed to demonstrate the man-in-the-middle vulnerability, due to the use of an http, i.e an unencrypted protocol sitting on top of tcp stack.

Disclamer
======
 The sole purpose of creation of this exploit was to provide a POC for the security constraint lying within the http protocol that allows extraction of extensively private data such as user credentials. And suggest a more improvised solution to it.
 The use of this program in any unethical or illegal means is prohibited, the user would be entirely responsible for the environment they choose to run the program in.

POC
======
 - Vulnerable Server: [http://kiitportal.kiituniversity.net/irj/portal](http://kiitportal.kiituniversity.net/irj/portal)
 - Credentials Server: [http://ec2-35-162-25-5.us-west-2.compute.amazonaws.com/credentials.txt](http://ec2-35-162-25-5.us-west-2.compute.amazonaws.com/credentials.txt)
 - Captured Request:
    ```
    POST /irj/portal HTTP/1.1
    Host: kiitportal.kiituniversity.net
    Connection: keep-alive
    Content-Length: 150
    Cache-Control: max-age=0
    Origin: http://kiitportal.kiituniversity.net
    Upgrade-Insecure-Requests: 1
    User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML,like Gecko) Chrome/59.0.3071.115 Safari/537.36
    Content-Type: application/x-www-form-urlencoded
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/png,*/*;q=0.8
    Referer: http://kiitportal.kiituniversity.net/irj/portal
    Accept-Encoding: gzip, deflate
    Accept-Language: en-US,en;q=0.8
    Cookie: com.sap.engine.security.authentication.original_application_url=GET#Qn%2F2jCf2HwdzRw306kKGDLETGHeoFVOG4w0Pa9hEJWFElI7XujhjZzxStFAID%2BNZDdJq6YeP6i%2B5vmoZRm7rgO6O92s6sFNTPBAtSmgaHRaTeh8bB5GtZA%3D%3D; JSESSIONID=jIdAKoP4FiE1jlIinek59lQVWBdFXAGcGFIA_SAPlXg98oh5Q4m1eVuRrHX4SIH5; SAPWP_active=1; JSESSIONMARKID=U0VIPwrHANhTKn6v-3lyRcKhUR23Bau4U6tJsYUgA; PortalAlias=portal; saplb_*=(J2EE5380220)5380251

    login_submit=on&login_do_redirect=1&no_cert_storing=on&j_salt=lNLdoDYBont5a8T%2B%2FT4inAK4J8s%3D&j_username=username&j_password=password&uidPasswordLogon=Log+On
    ```
    Within the post data, the HTTP packets are totally unencrypted and can be gathered using a basic sniffer. Further using regex, the packet can be disected and confedential data can be extracted easily.
    As in the above example, when the sign in page sends a post request to the server, the data block contains the username and password within the **j_username=username** and **j_password=password** parameters, which are totally unencrypted, leading to a major issue.

Demo
======
 1. Download the malware [executable](https://raw.githubusercontent.com/trishantofficial/kiitportal-exploit/master/dist/kiitportal_exploit.exe).
 2. Execute the program as Admin. The program is created in no_console mode, thus it would start working as a background process quietly.
 3. Login to [kiitportal.kiituniversity.net](http://kiitportal.kiituniversity.net/irj/portal).
 4. View your entered credentials at [credentials.txt](ec2-35-162-25-5.us-west-2.compute.amazonaws.com/credentials.txt).
 > Use at your own risk! Don't enter real credentials while logging in to the kiitportal server after executing the malware, as the credentials.txt file is viewable publically. Though the whole program is completely harmless as it is crafted to monitor only a specific request.
 5. Open taskmanager and end the process named kiitportal_exploit.

To-Dos:
======
- [x] Publish Exploit
- [x] Create demo executable
- [ ] Bypass Admin Privileges
> Can be performed using a compiled executable by metasploit, bypassuac.exe